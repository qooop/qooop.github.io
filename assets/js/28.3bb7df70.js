(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{401:function(e,s,a){"use strict";a.r(s);var n=a(44),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"qemu磁盘镜像的创建及挂载"}},[e._v("qemu磁盘镜像的创建及挂载")]),e._v(" "),a("p",[e._v("qemu磁盘镜像的创建及挂载涉及到qemu-img和qemu-nbd两个工具，本文基于debian系统，简单介绍这两个工具的基本用法。")]),e._v(" "),a("h3",{attrs:{id:"qemu-img及qemu-nbd工具的安装"}},[e._v("qemu-img及qemu-nbd工具的安装")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" qemu-utils\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"qemu-img的使用"}},[e._v("qemu-img的使用")]),e._v(" "),a("p",[e._v("qemu-img磁盘镜像的创建工具，支持多种格式。")]),e._v(" "),a("p",[e._v("创建qcow2格式的磁盘，大小10G，文件名test.img，此时文件并没有10G，随着数据的增加，会逐步增长到10G。")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("qemu-img create -f qcow2 test.img 10G\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("创建raw格式的磁盘，大小10G，文件名test.img，初始化完成后，文件大小就是10G。")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("qemu-img create -f raw test.img 10G\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("blockquote",[a("p",[e._v("创建完成之后需要挂载磁盘才能使用，qcow2格式的镜像文件，无法直接通过mount挂载，这里有多种方式挂载。")])]),e._v(" "),a("ul",[a("li",[e._v("使用qemu-nbd连接到镜像文件后挂载，qemu自带的工具")]),e._v(" "),a("li",[e._v("挂载到已有的系统上，比较取巧的方式，比如已经有了个qemu启动的alpine-linux，可以在启动命令上增加磁盘设备。")])]),e._v(" "),a("h3",{attrs:{id:"qemu-nbd的使用"}},[e._v("qemu-nbd的使用")]),e._v(" "),a("p",[e._v("网络设备/块的连接工具。")]),e._v(" "),a("p",[e._v("NBD指的是Network Block Device，NBD让用户可以通过网络访问到某个块设备，或者设备镜像。")]),e._v(" "),a("p",[e._v("查看/dev/nbd设备")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" /dev/nbd*\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("如果没有，则执行下面这行，加载 nbd 驱动，然后查看，就有了")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("modprobe nbd "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("max_part")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("连接镜像文件到/dev/nbd0设备，连接完成后，这个设备(/dev/nbd0)就代表着这个镜像文件")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("qemu-nbd -c /dev/nbd0 test.img\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("连接后可以用fdisk -l查看到/dev/nbd0设备，然后使用mkfs.ext4来格式化这个设备")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("mkfs.ext4 /dev/nbd0\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("格式化完成后，就可以挂载到目录了")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" /dev/nbd0 /mnt\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("挂载完成后，就可以随意读写镜像中的文件了。")]),e._v(" "),a("p",[e._v("断开/dev/nbd0设备")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("umount")]),e._v(" /mnt\nqemu-nbd -d /dev/nbd0\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);