<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä½¿ç”¨chrooté™åˆ¶sshç™»å½•åçš„ç›®å½• | ITå°åœŸè±†çš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/imgs/avatar.png">
    <meta name="description" content="æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨chrootæ­é…sshæœåŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªç‰¢ç¬¼ï¼Œé™åˆ¶ç”¨æˆ·sshç™»å½•åçš„ç›®å½•ã€‚">
    
    <link rel="preload" href="/assets/css/0.styles.842c6ab8.css" as="style"><link rel="preload" href="/assets/js/app.06b2cfed.js" as="script"><link rel="preload" href="/assets/js/5.409f605a.js" as="script"><link rel="preload" href="/assets/js/1.7de65476.js" as="script"><link rel="preload" href="/assets/js/24.928e3ecf.js" as="script"><link rel="prefetch" href="/assets/js/10.2518bbaf.js"><link rel="prefetch" href="/assets/js/11.70cdcfe4.js"><link rel="prefetch" href="/assets/js/12.2b0452ba.js"><link rel="prefetch" href="/assets/js/13.e10062ec.js"><link rel="prefetch" href="/assets/js/14.b845f569.js"><link rel="prefetch" href="/assets/js/15.01c85116.js"><link rel="prefetch" href="/assets/js/16.8c2c532a.js"><link rel="prefetch" href="/assets/js/17.fa46f4bb.js"><link rel="prefetch" href="/assets/js/18.4fca2f7f.js"><link rel="prefetch" href="/assets/js/19.d799b938.js"><link rel="prefetch" href="/assets/js/2.0e5a2e8f.js"><link rel="prefetch" href="/assets/js/20.c220685a.js"><link rel="prefetch" href="/assets/js/21.f9f141e3.js"><link rel="prefetch" href="/assets/js/22.c1dfef23.js"><link rel="prefetch" href="/assets/js/23.2b1d6a39.js"><link rel="prefetch" href="/assets/js/25.67789fce.js"><link rel="prefetch" href="/assets/js/26.4edce570.js"><link rel="prefetch" href="/assets/js/27.87fb18fa.js"><link rel="prefetch" href="/assets/js/28.2e17da8b.js"><link rel="prefetch" href="/assets/js/4.6b7fb84a.js"><link rel="prefetch" href="/assets/js/6.d3ebe8a5.js"><link rel="prefetch" href="/assets/js/7.4ef95f47.js"><link rel="prefetch" href="/assets/js/8.eb8cd85b.js"><link rel="prefetch" href="/assets/js/9.e56295fa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.842c6ab8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="container" data-v-6919a3da data-v-4baa6002><header class="header" data-v-6919a3da><div class="header-wrapper" data-v-6919a3da><div class="nav-bar" data-v-ed3580c2 data-v-6919a3da><div class="logo" data-v-ed3580c2><a href="/" class="router-link-active" data-v-ed3580c2><img src="/imgs/avatar.png" data-v-ed3580c2> <span data-v-ed3580c2>ITå°åœŸè±†çš„åšå®¢</span></a></div> <div class="spacer" data-v-ed3580c2></div> <div class="search-box" data-v-ed3580c2><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="links iconfont" data-v-c8b8ea8c data-v-ed3580c2><div class="link-wrapper" data-v-c8b8ea8c></div></div></div></div></header> <div class="banner" data-v-6919a3da></div> <main class="main" data-v-6919a3da><div class="main-wrapper" data-v-6919a3da><article class="article article-content" data-v-3e43c8e8 data-v-4baa6002><div class="content" data-v-3e43c8e8><h1 data-v-3e43c8e8>ä½¿ç”¨chrooté™åˆ¶sshç™»å½•åçš„ç›®å½•</h1> <div class="create-info" data-v-3e43c8e8>
      qooopç¼–è¾‘äº2020-10-31 18:46:30
    </div> <div class="tag-list" data-v-3e43c8e8><a href="/tags.html#linux" class="tag" data-v-56e6eb16 data-v-3e43c8e8>linux</a><a href="/tags.html#ssh" class="tag" data-v-56e6eb16 data-v-3e43c8e8>ssh</a><a href="/tags.html#chroot" class="tag" data-v-56e6eb16 data-v-3e43c8e8>chroot</a></div> <div class="internal-content content__default" data-v-3e43c8e8><h1 id="ä½¿ç”¨chrooté™åˆ¶sshç”¨æˆ·">ä½¿ç”¨chrooté™åˆ¶sshç”¨æˆ·</h1> <h3 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h3> <p>åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ªå¯ä»¥chrootçš„ç³»ç»Ÿï¼›å…³äºå¦‚ä½•åˆ›å»ºè¿™æ ·çš„ç³»ç»Ÿï¼Œè¯·å‚è€ƒå¦å¤–ä¸€ç‰‡æ–‡ç« <a href="/blogs/2021100901.html">ã€Šä½¿ç”¨supermin5åˆ›å»ºä¸€ä¸ªå¯ä»¥chrootçš„ç³»ç»Ÿã€‹</a>ã€‚</p> <p>å‡è®¾æ‚¨å·²ç»å‡†å¤‡å¥½äº†ä¸€ä¸ªå¯ä»¥chrootçš„ç›®å½•ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬ä»¥â€œtestç³»ç»Ÿâ€æ¥ç§°å‘¼è¿™ä¸ªç›®å½•ï¼Œå¹¶ä¸”testç³»ç»Ÿä½äº/data/chroot/testç›®å½•ï¼Œæœ¬æ–‡ä»¥testç”¨æˆ·ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨chrooté™åˆ¶testç”¨æˆ·ç™»å½•åçš„ç›®å½•ã€‚</p> <h3 id="åˆ›å»ºç™»å½•ç”¨æˆ·">åˆ›å»ºç™»å½•ç”¨æˆ·</h3> <p>å®¿ä¸»æœºå™¨å¢åŠ testç”¨æˆ·ï¼Œå¹¶è®¾ç½®ç™»å½•å¯†ç ã€‚-Må‚æ•°è¡¨ç¤ºä¸åˆ›å»ºç”¨æˆ·å®¶ç›®å½•ã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">useradd</span> -M <span class="token builtin class-name">test</span>
<span class="token function">passwd</span> <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åœ¨testç³»ç»Ÿä¸­å¢åŠ testç”¨æˆ·ï¼Œå¹¶åˆ›å»ºå®¶ç›®å½•ã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># æ–¹æ³•1ï¼šchrootåˆ°testç³»ç»Ÿï¼Œå†æ‰§è¡Œå¢åŠ ç”¨æˆ·å‘½ä»¤</span>
<span class="token function">chroot</span> /data/chroot/test
<span class="token function">useradd</span> <span class="token builtin class-name">test</span>

<span class="token comment"># æ–¹æ³•2ï¼šç›´æ¥åœ¨å®¿ä¸»æœºå™¨ä¸Šæ‰§è¡Œå¢åŠ ç”¨æˆ·å‘½ä»¤å¹¶æŒ‡å®š-R/--rootå‚æ•°</span>
<span class="token function">useradd</span> <span class="token builtin class-name">test</span> -R /data/chroot/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>-R, --rootå‚æ•°æŒ‡å®štestç³»ç»Ÿçš„ç›®å½•ï¼Œè¡¨ç¤ºä¿®æ”¹æ­¤ç›®å½•ä¸‹çš„ç›¸å…³é…ç½®æ–‡ä»¶</p></blockquote> <h3 id="sshdæœåŠ¡é…ç½®">sshdæœåŠ¡é…ç½®</h3> <p>ä¿®æ”¹å®¿ä¸»æœºå™¨çš„sshdæœåŠ¡é…ç½®æ–‡ä»¶/etc/ssh/sshd_configï¼Œåœ¨æ–‡ä»¶æœ«å°¾å¢åŠ ä»¥ä¸‹ä»£ç ã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Match User <span class="token builtin class-name">test</span>
    ChrootDirectory /data/chroot/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>Match Userè¡¨ç¤ºåŒ¹é…ç”¨æˆ·ï¼Œæ­¤å¤„åŒ¹é…testç”¨æˆ·ã€‚</li> <li>Matchä¸‹æ–¹çš„é…ç½®æ˜¯è¯¥ç”¨æˆ·ç‰¹æœ‰çš„é…ç½®ï¼Œæ‰€ä»¥è¿™æ®µé…ç½®ä¸€å®šè¦æ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ­¤å¤„ç¼©è¿›ä¸€æ ¼æ–¹ä¾¿æŸ¥çœ‹ã€‚</li> <li>ChrootDirectoryè¡¨ç¤ºå¼€å¯chrootåŠŸèƒ½å¹¶æŒ‡å®štestç³»ç»Ÿæ‰€åœ¨ç›®å½•ã€‚</li></ul> <p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯sshdæœåŠ¡ã€‚</p> <blockquote><p>é‡å¯sshdæœåŠ¡ä¹‹å‰ï¼ŒåŠ¡å¿…ä¿è¯æœ‰å…¶ä»–æ–¹å¼å¯ä»¥è·å–åˆ°æœåŠ¡å™¨çš„shellï¼Œé˜²æ­¢sshdæœåŠ¡é‡å¯å¤±è´¥å¯¼è‡´æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨çš„å°´å°¬æƒ…å†µğŸ˜…ã€‚</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">service</span> sshd restart
<span class="token comment"># æˆ–è€…</span>
systemctl restart sshd.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚æœéœ€è¦å°†å¤šä¸ªç”¨æˆ·é™åˆ¶åœ¨ä¸åŒæˆ–ç›¸åŒç›®å½•ï¼Œé‡å¤ä»¥ä¸Šä¸¤æ­¥éª¤ï¼Œé…ç½®å¤šä¸ªMatch Userç‰‡æ®µå³å¯å®ç°ã€‚</p> <h3 id="ä¿®æ”¹-dev-nullæ–‡ä»¶æƒé™">ä¿®æ”¹/dev/nullæ–‡ä»¶æƒé™</h3> <p>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œå…¶å®testç”¨æˆ·å°±å·²ç»å¯ä»¥ç™»å½•äº†ï¼Œåªæ˜¯ç™»å½•åshellä¼šæŠ¥é”™ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Â» ssh test@localhost
test@localhost's password: 
Last login: Sun Oct 31 18:39:30 2021 from gateway
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
-bash: /dev/null: Permission denied
[test@localhost ~]$ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦ä¿®æ”¹/dev/nullçš„æƒé™ä¸ºä»»ä½•äººå¯ä»¥è¯»å†™å³å¯ã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chroot</span> /data/chroot/test
<span class="token function">chmod</span> <span class="token number">777</span> /dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(å®Œ)</p></div></div> <div class="table-of-content" style="left:0px;" data-v-3e43c8e8><ul data-v-3e43c8e8></ul></div></article></div></main> <footer class="foot" data-v-6919a3da><div class="foot-wrapper" data-v-6919a3da>
        Copyright Â© 2021 ITå°åœŸè±† ç‰ˆæƒæ‰€æœ‰ã€‚æœ¬ç«™åŸºäºvuepressæ­å»ºï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·<a href="mailto:uuuuoooo@protonmail.com" data-v-6919a3da>è”ç³»ä½œè€…</a>ã€‚
      </div></footer> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.06b2cfed.js" defer></script><script src="/assets/js/5.409f605a.js" defer></script><script src="/assets/js/1.7de65476.js" defer></script><script src="/assets/js/24.928e3ecf.js" defer></script>
  </body>
</html>
